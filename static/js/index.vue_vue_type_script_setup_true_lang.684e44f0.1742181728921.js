import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.6f36d91a.1742181728921.js";import{cu as t,au as n,r as l,f as o,_ as a,l as i,x as r,m as c,k as s,e as u,c$ as d,d0 as p,n as f,u as v,o as h,$ as m,d1 as y,d2 as g,A as b}from"./index.fc641b56.1742181728921.js";import{_ as w}from"./index.vue_vue_type_script_setup_true_lang.5eb11789.1742181728921.js";import{c as _,_ as C}from"./index.vue_vue_type_script_setup_true_lang.141d1f64.1742181728921.js";import{_ as x}from"./index.vue_vue_type_script_setup_true_lang.dd273c02.1742181728921.js";import{x as k,m as R,d as F,o as U,b as T,e as E,k as M,$ as I,ae as S,X as O,f as $,J as j,P as A,aa as D,S as N,a2 as L,a3 as z,U as P,r as W,W as B,c as q,F as H,_ as G,a7 as K,ac as V,ao as X,u as Y,G as J,A as Q,s as Z,ap as ee,l as te,ad as ne,y as le,K as oe}from"./vue.314199b7.1742181728921.js";import{g as ae}from"./random.bb000beb.1742181728921.js";import{_ as ie}from"./utils.d31cac41.1742181728921.js";import{a as re}from"./DataTable.762c357a.1742181728921.js";import{_ as ce}from"./ButtonGroup.012fc319.1742181728921.js";import{N as se}from"./InputNumber.f6532dc5.1742181728921.js";import{c as ue,g as de}from"./layer.8f9c8930.1742181728921.js";import{a as pe}from"./area.fbb35970.1742181728921.js";const fe=Symbol("custom-rule");function ve(e){k(fe,e)}function he(){return R(fe)}const me=F({__name:"index",props:{count:{default:0}},setup:e=>(e,t)=>{const n=ie;return U(),T(n,{size:"small",type:e.count>0?"success":"default",bordered:!1},{default:E((()=>[M(I(e.count.toLocaleString()),1)])),_:1},8,["type"])}});var ye={exports:{}};
/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT © Zeno Rocha
 */const ge=de(ye.exports=function(){return function(){var e={686:function(e,t,n){n.d(t,{default:function(){return C}});var l=n(279),o=n.n(l),a=n(370),i=n.n(a),r=n(817),c=n.n(r);function s(e){try{return document.execCommand(e)}catch(t){return!1}}var u=function(e){var t=c()(e);return s("cut"),t},d=function(e,t){var n=function(e){var t="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";var l=window.pageYOffset||document.documentElement.scrollTop;return n.style.top="".concat(l,"px"),n.setAttribute("readonly",""),n.value=e,n}(e);t.container.appendChild(n);var l=c()(n);return s("copy"),n.remove(),l},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body},n="";return"string"==typeof e?n=d(e,t):e instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(null==e?void 0:e.type)?n=d(e.value,t):(n=c()(e),s("copy")),n};function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.action,n=void 0===t?"copy":t,l=e.container,o=e.target,a=e.text;if("copy"!==n&&"cut"!==n)throw new Error('Invalid "action" value, use either "copy" or "cut"');if(void 0!==o){if(!o||"object"!==f(o)||1!==o.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===n&&o.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===n&&(o.hasAttribute("readonly")||o.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}return a?p(a,{container:l}):o?"cut"===n?u(o):p(o,{container:l}):void 0};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,l,o,a=b(e);if(t){var i=b(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return l=this,!(o=n)||"object"!==h(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(l):o}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){var n="data-clipboard-".concat(e);if(t.hasAttribute(n))return t.getAttribute(n)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,l,o=g(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=o.call(this)).resolveOptions(t),n.listenClick(e),n}return t=a,n=[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===h(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=i()(e,"click",(function(e){return t.onClick(e)}))}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget,n=this.action(t)||"copy",l=v({action:n,container:this.container,target:this.target(t),text:this.text(t)});this.emit(l?"success":"error",{action:n,text:l,trigger:t,clearSelection:function(){t&&t.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(e){return w("action",e)}},{key:"defaultTarget",value:function(e){var t=w("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return w("text",e)}},{key:"destroy",value:function(){this.listener.destroy()}}],l=[{key:"copy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body};return p(e,t)}},{key:"cut",value:function(e){return u(e)}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach((function(e){n=n&&!!document.queryCommandSupported(e)})),n}}],n&&m(t.prototype,n),l&&m(t,l),a}(o()),C=_},828:function(e){if("undefined"!=typeof Element&&!Element.prototype.matches){var t=Element.prototype;t.matches=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector}e.exports=function(e,t){for(;e&&9!==e.nodeType;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},438:function(e,t,n){var l=n(828);function o(e,t,n,l,o){var i=a.apply(this,arguments);return e.addEventListener(n,i,o),{destroy:function(){e.removeEventListener(n,i,o)}}}function a(e,t,n,o){return function(n){n.delegateTarget=l(n.target,t),n.delegateTarget&&o.call(e,n)}}e.exports=function(e,t,n,l,a){return"function"==typeof e.addEventListener?o.apply(null,arguments):"function"==typeof n?o.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return o(e,t,n,l,a)})))}},879:function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},370:function(e,t,n){var l=n(879),o=n(438);e.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!l.string(t))throw new TypeError("Second argument must be a String");if(!l.fn(n))throw new TypeError("Third argument must be a Function");if(l.node(e))return function(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}(e,t,n);if(l.nodeList(e))return function(e,t,n){return Array.prototype.forEach.call(e,(function(e){e.addEventListener(t,n)})),{destroy:function(){Array.prototype.forEach.call(e,(function(e){e.removeEventListener(t,n)}))}}}(e,t,n);if(l.string(e))return function(e,t,n){return o(document.body,e,t,n)}(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},817:function(e){e.exports=function(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var l=window.getSelection(),o=document.createRange();o.selectNodeContents(e),l.removeAllRanges(),l.addRange(o),t=l.toString()}return t}},279:function(e){function t(){}t.prototype={on:function(e,t,n){var l=this.e||(this.e={});return(l[e]||(l[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var l=this;function o(){l.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),l=0,o=n.length;l<o;l++)n[l].fn.apply(n[l].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),l=n[e],o=[];if(l&&t)for(var a=0,i=l.length;a<i;a++)l[a].fn!==t&&l[a].fn._!==t&&o.push(l[a]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(l){if(t[l])return t[l].exports;var o=t[l]={exports:{}};return e[l](o,o.exports,n),o.exports}return n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var l in t)n.o(t,l)&&!n.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n(686)}().default}()),be=e=>{const t=void 0===(null==e?void 0:e.appendToBody)||e.appendToBody;return{toClipboard:(e,n)=>new Promise(((l,o)=>{const a=document.createElement("button"),i=new ge(a,{text:()=>e,action:()=>"copy",container:void 0!==n?n:document.body});i.on("success",(e=>{i.destroy(),l(e)})),i.on("error",(e=>{i.destroy(),o(e)})),t&&document.body.appendChild(a),a.click(),t&&document.body.removeChild(a)}))}},we=F({__name:"index",props:{value:{default:null},isInit:{type:Boolean,default:!0}},setup(e){const a=S(e,"value"),i=t(),{sitesOption:r}=O(i),c=()=>{a.value=r.value.map((e=>e.value))},s=()=>{a.value=[]};return(async()=>{const{res:e}=await n(),{list:t}=e;l(t)?r.value=t.map((e=>({label:e.site_name||e.site_id,value:e.site_id}))):r.value=[]})(),(e,t)=>{const n=o,l=ce,i=re;return U(),T(i,j(e.$attrs,{value:A(a),"onUpdate:value":t[0]||(t[0]=e=>D(a)?a.value=e:null),multiple:"","max-tag-count":"responsive",options:A(r),"consistent-menu-width":!1,filterable:"",disabled:!1,placeholder:"请选择网站"}),{action:E((()=>[$(l,null,{default:E((()=>[$(n,{onClick:c},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.All")),1)])),_:1}),$(n,{onClick:s},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.NotAll")),1)])),_:1})])),_:1})])),_:1},16,["value","options"])}}}),_e={class:"my-18px"};const Ce=a({},[["render",function(e,t){const n=ie;return U(),N("div",_e,[$(n,{class:"w-38px justify-center"},{default:E((()=>[M("Or")])),_:1})])}]]),xe={},ke=e=>(L("data-v-bd6ea0ee"),e=e(),z(),e),Re={class:"flex flex-center flex-col w-38px"},Fe=ke((()=>P("div",{class:"seg"},null,-1))),Ue=ke((()=>P("div",{class:"seg"},null,-1)));const Te=a(xe,[["render",function(e,t){const n=ie;return U(),N("div",Re,[Fe,$(n,{class:"w-38px justify-center"},{default:E((()=>[M("And")])),_:1}),Ue])}],["__scopeId","data-v-bd6ea0ee"]]),Ee=()=>({areaOptions:W(pe.map(((e,t)=>0===t?{label:e,value:"海外"}:1===t?{label:e,value:"中国"}:2===t?{label:e,value:"香港"}:3===t?{label:e,value:"澳门"}:4===t?{label:e,value:"台湾"}:{label:e,value:e})))}),Me={class:"relative flex items-center w-full h-full"},Ie={class:"tips"},Se=a(F({__name:"content",props:{input:{default:""},select:{default:null},condition:{default:null},factor:{},type:{default:"right"}},setup(e){const t=e,{t:n}=B(),a=S(t,"input"),r=S(t,"select"),c=q((()=>null===t.condition)),s=["select","area_select"],u=["in","not_in"],d=q((()=>{const{factor:e}=t;return"text"===e.widget.type})),p=q((()=>{const{factor:e}=t;return s.includes(e.widget.type)})),f=q((()=>"left"!==t.type&&u.includes(t.condition||""))),{areaOptions:v}=Ee(),h=q((()=>{const{factor:e}=t,{widget:n}=e;return"area_select"===n.type?v.value:n.value.map((e=>({label:e.label,value:e.key})))})),m=()=>{r.value=h.value.map((e=>e.value))},y=()=>{r.value=[]},g=W(""),b=e=>{g.value=e},w=()=>{""!==g.value&&(l(r.value)?l(r.value)&&!r.value.includes(g.value)&&r.value.push(g.value):r.value=[g.value],g.value="")};return(e,t)=>{const l=i,s=re,u=o,v=ce;return U(),N("div",Me,[A(d)?(U(),N(H,{key:0},[A(f)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[1]||(t[1]=e=>D(r)?r.value=e:null),tag:"",multiple:"",filterable:"","show-arrow":!1,show:!1,"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder,onSearch:b,onBlur:w},null,8,["value","placeholder"])):(U(),T(l,{key:0,value:A(a),"onUpdate:value":t[0]||(t[0]=e=>D(a)?a.value=e:null),spellcheck:"false",disabled:A(c),placeholder:e.factor.widget.placeholder},null,8,["value","disabled","placeholder"])),P("div",Ie,I(e.factor.widget.hint?"".concat(e.factor.widget.hint).concat(A(f)?"，".concat(A(n)("CustomRule.Enter")):""):""),1)],64)):G("",!0),A(p)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[2]||(t[2]=e=>D(r)?r.value=e:null),options:A(h),disabled:A(c),multiple:A(f),"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder},K({_:2},[A(f)?{name:"action",fn:E((()=>[$(v,null,{default:E((()=>[$(u,{onClick:m},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.All")),1)])),_:1}),$(u,{onClick:y},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.NotAll")),1)])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["value","options","disabled","multiple","placeholder"])):G("",!0)])}}}),[["__scopeId","data-v-65c342b6"]]),Oe=e=>(L("data-v-67192deb"),e=e(),z(),e),$e={class:"rows title"},je={class:"field"},Ae={class:"condition"},De={class:"content"},Ne=Oe((()=>P("div",{class:"btn"},null,-1))),Le={class:"rows"},ze={class:"field"},Pe={class:"condition"},We={class:"content"},Be={key:0,class:"w-140px mr-8px"},qe={class:"flex-1 w-0"},He={class:"btn"},Ge=["onClick"],Ke=Oe((()=>P("div",null,null,-1))),Ve=a(F({__name:"index",props:{isInit:{type:Boolean,default:!0},value:{default:()=>[]}},setup(e,{expose:n}){const a=e,i=S(a,"value"),c=t(),{config:s}=O(c),u={type:"or",children:[]},d={input:"",select:null,show:!1,widget:{hint:"",placeholder:"",type:"text",value:[]}},p={type:"and",field:null,condition:null,conOptions:[],leftFactor:_(d),rightFactor:_(d)},f=["select","area_select"],v=["in","not_in"],h=q((()=>s.value?s.value.options.map((e=>({label:e.text,value:e.type,data:e}))):[])),m=(e,t)=>(n,l)=>{const o=i.value[e].children[t],a=l.data;o.conOptions=a.operators.map((e=>({label:c.getOperatorName(e),value:e}))),o.condition=a.operators[0]||null,o.leftFactor=_(d),o.rightFactor=_(d),a.left_factor_enabled&&(o.leftFactor.show=a.left_factor_enabled,o.leftFactor.widget=a.left_widget),a.right_factor_enabled&&(o.rightFactor.widget=a.right_widget,o.rightFactor.show=a.right_factor_enabled)},y=(e,t)=>n=>{const o=i.value[e].children[t],{rightFactor:a}=o,{widget:r}=a;if(f.includes(r.type)){if(null===a.select)return;v.includes(n||"")?a.select=l(a.select)?a.select:[a.select]:a.select=l(a.select)?a.select[0]:a.select}"text"===r.type&&(v.includes(n||"")&&""!==a.input&&(a.select=[a.input],a.input=""),null!==a.select&&(a.input=l(a.select)?a.select[0]:a.select))},g=q((()=>i.value.map((e=>e.children.length)).reduce(((e,t)=>e+t))>1)),b=(e,t)=>t===i.value.length-1&&e===i.value[t].children.length-1,w=(e,t=0)=>{i.value[t].children.splice(e+1,0,_(p))},C=()=>{i.value.push(_(u)),w(0,i.value.length-1)},x=(e,t,n)=>"text"!==n.widget.type||v.includes(t)?"":e,k=(e,t,n)=>v.includes(t)?e?e.split(","):[]:f.includes(n.widget.type)&&e||null;return a.isInit&&0===i.value.length&&C(),n({setRules:e=>{const t=[];e.children.forEach((e=>{const n=_(u);e.children.forEach((e=>{const{option:t}=e;if(!t)return;const l=_(p);l.field=t.type,l.condition=t.operator,((e,t)=>{if(s.value){const{options:n}=s.value;for(let l=0;l<n.length;l++)if(n[l].type===e){t(n[l]);break}}})(t.type,(e=>{if(e.left_factor_enabled){const n=(null==t?void 0:t.left_factor)||"";l.leftFactor.show=e.left_factor_enabled,l.leftFactor.widget=e.left_widget,l.leftFactor.input=x(n,t.operator,l.leftFactor),l.leftFactor.select=k(n,t.operator,l.leftFactor)}if(e.right_factor_enabled){const n=(null==t?void 0:t.right_factor)||"";l.rightFactor.show=e.right_factor_enabled,l.rightFactor.widget=e.right_widget,l.rightFactor.input=x(n,t.operator,l.rightFactor),l.rightFactor.select=k(n,t.operator,l.rightFactor)}l.conOptions=e.operators.map((e=>({label:c.getOperatorName(e),value:e})))})),n.children.push(l)})),t.push(n)})),t.length>0?i.value=t:C()}}),(e,t)=>{const n=re,l=o,a=r;return U(),N("div",null,[P("div",$e,[P("div",je,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.0")),1),P("div",Ae,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.1")),1),P("div",De,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.2")),1),Ne]),(U(!0),N(H,null,V(A(i),((e,t)=>(U(),N("div",{key:"".concat(t+1)},[0!==t?(U(),T(Ce,{key:0})):G("",!0),(U(!0),N(H,null,V(e.children,((e,o)=>(U(),N("div",{key:"".concat(o+1)},[0!==o?(U(),T(Te,{key:0})):G("",!0),P("div",Le,[P("div",ze,[$(n,j({value:e.field,"onUpdate:value":t=>e.field=t,options:A(h),"consistent-menu-width":!1},X({"update:value":m(t,o)})),null,16,["value","onUpdate:value","options"])]),P("div",Pe,[e.leftFactor.show?(U(),T(Se,{key:0,input:e.leftFactor.input,"onUpdate:input":t=>e.leftFactor.input=t,select:e.leftFactor.select,"onUpdate:select":t=>e.leftFactor.select=t,type:"left",condition:e.condition,factor:e.leftFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])):(U(),T(n,j({key:1,value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"]))]),P("div",We,[e.leftFactor.show?(U(),N("div",Be,[$(n,j({value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"])])):G("",!0),P("div",qe,[$(Se,{input:e.rightFactor.input,"onUpdate:input":t=>e.rightFactor.input=t,select:e.rightFactor.select,"onUpdate:select":t=>e.rightFactor.select=t,type:"right",condition:e.condition,factor:e.rightFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])])]),P("div",He,[$(l,{onClick:e=>w(o,t)},{default:E((()=>[M("And")])),_:2},1032,["onClick"]),b(o,t)?(U(),T(l,{key:0,class:"ml-8px",onClick:C},{default:E((()=>[M("Or")])),_:1})):G("",!0),A(g)?(U(),N("div",{key:1,class:"close",onClick:e=>((e,t)=>{const n=i.value[t];n.children.length>1?n.children.splice(e,1):i.value.splice(t,1)})(o,t)},[$(a,{name:"close",size:"16"})],8,Ge)):G("",!0)])])])))),128))])))),128)),Ke])}}}),[["__scopeId","data-v-67192deb"]]),Xe={class:"w-200px"},Ye={class:"w-200px"},Je=F({__name:"execute",props:{action:{default:"deny"},response:{default:null}},setup(e){const n=e,l=S(n,"action"),o=S(n,"response"),a=t(),{executeOptions:i}=O(a),r=W([]),s=(e,t)=>{const{data:n}=t,{response:l}=n;r.value=l.map((e=>({label:e.text,value:e.type}))),l.length>0?o.value=l[0].type:o.value=null};return(()=>{const{data:e}=i.value.find((e=>e.value===l.value)),{response:t}=e;r.value=t.map((e=>({label:e.text,value:e.type}))),t.length>0&&null===o.value&&(o.value=t[0].type)})(),(e,t)=>{const n=re,a=c;return U(),N(H,null,[$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.Action")},{default:E((()=>[P("div",Xe,[$(n,{value:A(l),"onUpdate:value":[t[0]||(t[0]=e=>D(l)?l.value=e:null),s],options:A(i)},null,8,["value","options"])])])),_:1},8,["label"]),A(r).length>0?(U(),T(a,{key:0,"show-feedback":!1,label:"deny"===A(l)?e.$t("CustomRule.Interdiction.Modal.Content.Response"):e.$t("CustomRule.Interdiction.Modal.Content.Verification")},{default:E((()=>[P("div",Ye,[$(n,{value:A(o),"onUpdate:value":t[1]||(t[1]=e=>D(o)?o.value=e:null),options:A(r)},null,8,["value","options"])])])),_:1},8,["label"])):G("",!0)],64)}}}),Qe={class:"w-800px p-24px"},Ze={class:"title"},et={class:"w-200px"},tt=(e=>(L("data-v-40bb34f3"),e=e(),z(),e))((()=>P("span",null,"复制域名",-1))),nt={class:"w-200px"},lt={class:"title mt-8px"},ot={class:"flex-1"},at={class:"title mt-8px"},it=a(F({__name:"index",setup(e,{expose:n}){const{t:a}=B(),{isEdit:v,row:h}=R("component-data"),{getList:m}=he(),y=t(),{sitesOption:g}=O(y),b=Y({name:"",server:[],action:"deny",response:null}),w={name:{required:!0,message:"".concat(a("CustomRule.Interdiction.Modal.Content.RuleName.Placeholder")),trigger:["blur","input"]},rules:{validator:()=>{for(let e=0;e<_.value.length;e++){const t=_.value[e];for(let e=0;e<t.children.length;e++){const n=t.children[e];if(null===n.field||null===n.condition)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")));const{leftFactor:l,rightFactor:o}=n;if(l.show&&""===l.input&&null===l.select)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")));if(o.show&&""===o.input&&null===o.select)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")))}}return!0}}},_=W([]),C=W(null),x=W(),k=W("");J((()=>{if(g.value.length>0){const e=b.server.map((e=>{const t=g.value.find((t=>t.value===e));return null==t?void 0:t.label}));k.value=e.join(", ")}}));const{toClipboard:F}=be(),T=async e=>{try{await F(k.value,e.currentTarget),s("复制成功")}catch(t){u("复制失败")}},M=()=>{const e=S();return _.value.forEach((t=>{const n=S("and");t.children.forEach((e=>{null===e.field&&null===e.condition||n.children.push(j(e))})),e.children.push(n)})),e},S=(e="or")=>({logic:e,type:"block",option:null,children:[]}),j=e=>({type:"option",logic:"",children:[],option:{type:e.field||"",operator:e.condition||"",left_factor:z(e.condition,e.leftFactor),right_factor:z(e.condition,e.rightFactor)}}),L=["in","not_in"],z=(e,t)=>{const{widget:n}=t;return"text"!==n.type||L.includes(e||"")?l(t.select)?t.select.join(","):t.select||"":t.input};return v&&(b.name=h.name,b.server=h.servers||null,b.action=h.action.type,b.response=h.action.response.type,Q((()=>{x.value.setRules(h.root)}))),n({onConfirm:async e=>{var t;await(null==(t=C.value)?void 0:t.validate());const n=(()=>{const{action:e,response:t}=b;return"allow"===e&&null===t&&(b.response="black_page"),{name:b.name,servers:b.server?b.server:[],status:1,is_global:0,priority:0,root:M(),action:{type:b.action,response:{type:b.response||"",response_id:0,status:0,headers:{},body:""}}}})();v?await d({...n,id:h.id}):await p(n),m(),e()}}),(e,t)=>{const n=r,l=o,a=c,s=i,u=f;return U(),N("div",Qe,[$(u,{ref_key:"formRef",ref:C,model:A(b),rules:w,"label-width":"116px","label-placement":"left","require-mark-placement":"left"},{default:E((()=>[P("div",Ze,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.0")),1),$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.Server")},{default:E((()=>[P("div",et,[$(we,{value:A(b).server,"onUpdate:value":t[0]||(t[0]=e=>A(b).server=e),"is-init":!A(v)},null,8,["value","is-init"])]),$(l,{size:"tiny",class:"ml-1.6rem",onClick:T},{default:E((()=>[$(n,{name:"copy",class:"mr-1",size:"13"}),tt])),_:1})])),_:1},8,["label"]),$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.RuleName.Name"),path:"name"},{default:E((()=>[P("div",nt,[$(s,{value:A(b).name,"onUpdate:value":t[1]||(t[1]=e=>A(b).name=e),spellcheck:"false",placeholder:e.$t("CustomRule.Interdiction.Modal.Content.RuleName.Placeholder")},null,8,["value","placeholder"])])])),_:1},8,["label"]),P("div",lt,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.1")),1),$(a,{label:"",class:"pl-36px",path:"rules"},{default:E((()=>[P("div",ot,[$(Ve,{ref_key:"ruleRef",ref:x,value:A(_),"onUpdate:value":t[2]||(t[2]=e=>D(_)?_.value=e:null),"is-init":!A(v)},null,8,["value","is-init"])])])),_:1}),P("div",at,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.2")),1),$(Je,{action:A(b).action,"onUpdate:action":t[3]||(t[3]=e=>A(b).action=e),response:A(b).response,"onUpdate:response":t[4]||(t[4]=e=>A(b).response=e)},null,8,["action","response"])])),_:1},8,["model"])])}}}),[["__scopeId","data-v-40bb34f3"]]),rt=P("p",{class:"text-desc mb-10px"},"*注：命中次数每3秒钟且需要有新请求触发才会更新一次",-1);function ct(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!te(e)}const st=F({__name:"index",setup(n){const{t:a}=B(),i=t(),{search:r}=O(i),c=Y({data:[],total:0}),{loading:s,setLoading:u}=v(),d=async()=>{try{u(!0),await i.getConfig();const{res:e}=await g(ne(r.value)),{list:t,total:n}=e;c.data=l(t)?t:[],c.total=n}finally{u(!1)}},f=()=>{r.value.p=1,d()},_=Y({show:!1,title:"".concat(a("CustomRule.Interdiction.Modal.AddTitle")),data:{isEdit:!1,row:{}}}),k=()=>{_.data.isEdit=!1,_.data.row={},_.title="".concat(a("CustomRule.Interdiction.Modal.AddTitle")),_.show=!0},R=W([{key:"name",title:"".concat(a("CustomRule.Interdiction.Table.Name")),minWidth:160,ellipsis:{tooltip:{width:"trigger"}}},{key:"servers",title:"".concat(a("CustomRule.Interdiction.Table.Servers")),width:"16%",minWidth:140,ellipsis:{tooltip:{width:"trigger"}},render:e=>i.getSiteName(e.servers)},{key:"hit",title:"".concat(a("CustomRule.Interdiction.Table.Hit")),width:"10%",minWidth:100,render:e=>$(me,{count:e.hit},null)},{key:"root",title:"".concat(a("CustomRule.Interdiction.Table.Root")),width:"24%",minWidth:160,render:({root:e})=>(e=>{const t=[],n=e=>{for(let l=0;l<e.length;l++)if("block"===e[l].type)n(e[l].children);else if("option"===e[l].type){const{option:n}=e[l];n&&t.push(n.type)}};return n(e.children),[...new Set(t)].map((e=>i.getConditionName(e))).join("，")})(e)},{key:"action",title:"".concat(a("CustomRule.Interdiction.Table.Action")),width:"12%",minWidth:120,render:({action:e})=>{var t;return i.getExecuteOpt(e.type,(null==(t=e.response)?void 0:t.type)||"")}},{key:"action",title:"".concat(a("Public.Table.Action")),width:"10%",minWidth:100,render:e=>{let t,n;return $("div",{class:"action"},[$(h,{onClick:()=>{S(e)}},{default:()=>[M("复制")]}),$(h,{onClick:()=>{F(e)}},ct(t=a("Public.Btn.Edit"))?t:{default:()=>[t]}),$(h,{onClick:()=>{I(e)}},ct(n=a("Public.Btn.Del"))?n:{default:()=>[n]})])}}]),F=e=>{_.data.isEdit=!0,_.data.row=e,_.title="".concat(a("CustomRule.Interdiction.Modal.EditTitle"),"【").concat(e.name,"】"),_.show=!0},I=e=>{m({title:"".concat(a("CustomRule.Interdiction.DelModal.TitLe"),"【").concat(e.name,"】"),content:"".concat(a("CustomRule.Interdiction.DelModal.Content")),onConfirm:async()=>{await y({ids:[e.id]}),d()}})},S=e=>{const t=(e=>{const t=ne(e);return{name:"".concat(t.name,"_copy_").concat(ae(6)),servers:t.servers?t.servers:[],status:1,is_global:0,priority:0,root:t.root,action:{type:t.action.type,response:{...t.action.response,headers:{}}}}})(e);m({title:"复制规则【".concat(e.name,"】"),content:"是否复制该规则，并创建为新规则？",onConfirm:async()=>{await p(t),d()}})};return ve({getList:d}),Z((()=>{d()})),ee((()=>{i.clearConfig()})),(t,n)=>{const l=o,a=x,i=C,u=w,p=b,v=e;return U(),T(v,null,{toolsLeft:E((()=>[$(l,{type:"primary",onClick:k},{default:E((()=>[M("添加自定义拦截")])),_:1})])),toolsRight:E((()=>[$(a,{value:A(r).keyword,"onUpdate:value":n[0]||(n[0]=e=>A(r).keyword=e),placeholder:t.$t("CustomRule.Search"),onSearch:f},null,8,["value","placeholder"])])),content:E((()=>[rt,$(i,{loading:A(s),data:A(c).data,columns:A(R)},null,8,["loading","data","columns"])])),pageRight:E((()=>[$(u,{page:A(r).p,"onUpdate:page":n[1]||(n[1]=e=>A(r).p=e),"page-size":A(r).p_size,"onUpdate:pageSize":n[2]||(n[2]=e=>A(r).p_size=e),"item-count":A(c).total,onRefresh:d},null,8,["page","page-size","item-count"])])),modal:E((()=>[$(p,{show:A(_).show,"onUpdate:show":n[3]||(n[3]=e=>A(_).show=e),title:A(_).title,data:A(_).data,padding:"0","is-footer":!0,component:it},null,8,["show","title","data"])])),_:1})}}}),ut={class:"my-18px"};const dt=a({},[["render",function(e,t){const n=ie;return U(),N("div",ut,[$(n,{class:"w-38px justify-center"},{default:E((()=>[M("Or")])),_:1})])}]]),pt={},ft=e=>(L("data-v-c29781f1"),e=e(),z(),e),vt={class:"flex flex-center flex-col w-38px"},ht=ft((()=>P("div",{class:"seg"},null,-1))),mt=ft((()=>P("div",{class:"seg"},null,-1)));const yt=a(pt,[["render",function(e,t){const n=ie;return U(),N("div",vt,[ht,$(n,{size:"small",class:"w-38px justify-center"},{default:E((()=>[M("And")])),_:1}),mt])}],["__scopeId","data-v-c29781f1"]]),gt={class:"relative flex items-center w-full h-full"},bt={class:"tips"},wt=a(F({__name:"content",props:{input:{default:""},select:{default:null},condition:{default:null},factor:{},type:{default:"right"}},setup(e){const t=e,{t:n}=B(),a=S(t,"input"),r=S(t,"select"),c=q((()=>null===t.condition)),s=["select","area_select"],u=["in","not_in"],d=q((()=>{const{factor:e}=t;return"text"===e.widget.type})),p=q((()=>{const{factor:e}=t;return s.includes(e.widget.type)})),f=q((()=>"left"!==t.type&&u.includes(t.condition||""))),{areaOptions:v}=Ee(),h=q((()=>{const{factor:e}=t,{widget:n}=e;return"area_select"===n.type?v.value:n.value.map((e=>({label:e.label,value:e.key})))})),m=()=>{r.value=h.value.map((e=>e.value))},y=()=>{r.value=[]},g=W(""),b=e=>{g.value=e},w=()=>{""!==g.value&&(l(r.value)?l(r.value)&&!r.value.includes(g.value)&&r.value.push(g.value):r.value=[g.value],g.value="")};return(e,t)=>{const l=i,s=re,u=o,v=ce;return U(),N("div",gt,[A(d)?(U(),N(H,{key:0},[A(f)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[1]||(t[1]=e=>D(r)?r.value=e:null),tag:"",multiple:"",filterable:"","show-arrow":!1,show:!1,"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder,onSearch:b,onBlur:w},null,8,["value","placeholder"])):(U(),T(l,{key:0,value:A(a),"onUpdate:value":t[0]||(t[0]=e=>D(a)?a.value=e:null),spellcheck:"false",disabled:A(c),placeholder:e.factor.widget.placeholder},null,8,["value","disabled","placeholder"])),P("div",bt,I(e.factor.widget.hint?"".concat(e.factor.widget.hint).concat(A(f)?"，".concat(A(n)("CustomRule.Enter")):""):""),1)],64)):G("",!0),A(p)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[2]||(t[2]=e=>D(r)?r.value=e:null),options:A(h),disabled:A(c),multiple:A(f),"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder},K({_:2},[A(f)?{name:"action",fn:E((()=>[$(v,null,{default:E((()=>[$(u,{onClick:m},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.All")),1)])),_:1}),$(u,{onClick:y},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.NotAll")),1)])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["value","options","disabled","multiple","placeholder"])):G("",!0)])}}}),[["__scopeId","data-v-45f1adfa"]]),_t={class:"mt-8px"},Ct={class:"rows title"},xt={class:"field"},kt={class:"condition"},Rt={class:"content"},Ft=(e=>(L("data-v-b0b0e6e6"),e=e(),z(),e))((()=>P("div",{class:"btn"},null,-1))),Ut={class:"rows"},Tt={class:"field"},Et={class:"condition"},Mt={class:"content"},It={key:0,class:"w-140px mr-8px"},St={class:"flex-1 w-0"},Ot={class:"btn"},$t=["onClick"],jt={class:"mt-24px"},At={class:"ml-8px"},Dt=a(F({__name:"index",props:{isInit:{type:Boolean,default:!0},value:{default:()=>[]}},setup(e,{expose:n}){const o=e,a=S(o,"value"),i=t(),{config:c}=O(i),s={type:"or",children:[]},u={input:"",select:null,show:!1,widget:{hint:"",placeholder:"",type:"text",value:[]}},d={type:"and",field:null,condition:null,conOptions:[],leftFactor:_(u),rightFactor:_(u)},p=["select","area_select"],f=["in","not_in"],v=q((()=>c.value?c.value.options.map((e=>({label:e.text,value:e.type,data:e}))):[])),m=(e,t)=>(n,l)=>{const o=a.value[e].children[t],r=l.data;o.conOptions=r.operators.map((e=>({label:i.getOperatorName(e),value:e}))),o.condition=r.operators[0]||null,o.leftFactor=_(u),o.rightFactor=_(u),r.left_factor_enabled&&(o.leftFactor.show=r.left_factor_enabled,o.leftFactor.widget=r.left_widget),r.right_factor_enabled&&(o.rightFactor.widget=r.right_widget,o.rightFactor.show=r.right_factor_enabled)},y=(e,t)=>n=>{const o=a.value[e].children[t],{rightFactor:i}=o,{widget:r}=i;if(p.includes(r.type)){if(null===i.select)return;f.includes(n||"")?i.select=l(i.select)?i.select:[i.select]:i.select=l(i.select)?i.select[0]:i.select}"text"===r.type&&(f.includes(n||"")&&""!==i.input&&(i.select=[i.input],i.input=""),null!==i.select&&(i.input=l(i.select)?i.select[0]:i.select))},g=q((()=>a.value.map((e=>e.children.length)).reduce(((e,t)=>e+t))>1)),b=(e,t=0)=>{const n=a.value[t];void 0===e&&(e=n.children.length-1),n.children.splice(e+1,0,_(d))},w=()=>{a.value.push(_(s)),b(0,a.value.length-1)},C=(e,t,n)=>"text"!==n.widget.type||f.includes(t)?"":e,x=(e,t,n)=>f.includes(t)?e?e.split(","):[]:p.includes(n.widget.type)&&e||null;return o.isInit&&0===a.value.length&&w(),n({setRules:e=>{const t=[];e.children.forEach((e=>{const n=_(s);e.children.forEach((e=>{const{option:t}=e;if(!t)return;const l=_(d);l.field=t.type,l.condition=t.operator,((e,t)=>{if(c.value){const{options:n}=c.value;for(let l=0;l<n.length;l++)if(n[l].type===e){t(n[l]);break}}})(t.type,(e=>{if(e.left_factor_enabled){const n=(null==t?void 0:t.left_factor)||"";l.leftFactor.show=e.left_factor_enabled,l.leftFactor.widget=e.left_widget,l.leftFactor.input=C(n,t.operator,l.leftFactor),l.leftFactor.select=x(n,t.operator,l.leftFactor)}if(e.right_factor_enabled){const n=(null==t?void 0:t.right_factor)||"";l.rightFactor.show=e.right_factor_enabled,l.rightFactor.widget=e.right_widget,l.rightFactor.input=C(n,t.operator,l.rightFactor),l.rightFactor.select=x(n,t.operator,l.rightFactor)}l.conOptions=e.operators.map((e=>({label:i.getOperatorName(e),value:e})))})),n.children.push(l)})),t.push(n)})),t.length>0?a.value=t:w()}}),(e,t)=>{const n=re,l=r,o=h;return U(),N("div",_t,[P("div",Ct,[P("div",xt,I(e.$t("CustomRule.CcDefend.Modal.Content.Rows.0")),1),P("div",kt,I(e.$t("CustomRule.CcDefend.Modal.Content.Rows.1")),1),P("div",Rt,I(e.$t("CustomRule.CcDefend.Modal.Content.Rows.2")),1),Ft]),(U(!0),N(H,null,V(A(a),((e,t)=>(U(),N("div",{key:"".concat(t+1)},[0!==t?(U(),T(dt,{key:0})):G("",!0),(U(!0),N(H,null,V(e.children,((e,o)=>(U(),N("div",{key:"".concat(o+1)},[0!==o?(U(),T(yt,{key:0})):G("",!0),P("div",Ut,[P("div",Tt,[$(n,j({value:e.field,"onUpdate:value":t=>e.field=t,options:A(v),"consistent-menu-width":!1},X({"update:value":m(t,o)})),null,16,["value","onUpdate:value","options"])]),P("div",Et,[e.leftFactor.show?(U(),T(wt,{key:0,input:e.leftFactor.input,"onUpdate:input":t=>e.leftFactor.input=t,select:e.leftFactor.select,"onUpdate:select":t=>e.leftFactor.select=t,type:"left",condition:e.condition,factor:e.leftFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])):(U(),T(n,j({key:1,value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"]))]),P("div",Mt,[e.leftFactor.show?(U(),N("div",It,[$(n,j({value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"])])):G("",!0),P("div",St,[$(wt,{input:e.rightFactor.input,"onUpdate:input":t=>e.rightFactor.input=t,select:e.rightFactor.select,"onUpdate:select":t=>e.rightFactor.select=t,type:"right",condition:e.condition,factor:e.rightFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])])]),P("div",Ot,[A(g)?(U(),N("div",{key:0,class:"icon-btn",onClick:e=>((e,t)=>{const n=a.value[t];n.children.length>1?n.children.splice(e,1):a.value.splice(t,1)})(o,t)},[$(l,{name:"close",size:"15"})],8,$t)):G("",!0)])])])))),128))])))),128)),P("div",jt,[$(o,{onClick:t[0]||(t[0]=e=>b())},{default:E((()=>[M(I(e.$t("CustomRule.CcDefend.Modal.Content.Add")),1)])),_:1}),P("span",At,I(e.$t("CustomRule.CcDefend.Modal.Content.Tip")),1)])])}}}),[["__scopeId","data-v-b0b0e6e6"]]),Nt={class:"w-200px"},Lt={class:"w-200px"},zt={class:"w-200px"},Pt={class:"w-200px"},Wt=F({__name:"execute",props:{action:{default:"deny"},status:{default:null},response:{default:null},blockTime:{}},setup(e){const n=e,l=S(n,"action"),o=S(n,"blockTime"),a=S(n,"status"),i=S(n,"response"),r=t(),{executeOptions:s,statusOptions:u}=O(r),d=W([]),p=(e,t)=>{const{data:n}=t,{response:l}=n;d.value=l.map((e=>({label:e.text,value:e.type}))),l.length>0?i.value=l[0].type:i.value=null,"deny"===e?(a.value=u.value[0].value,i.value="no_response"):a.value=null};return(()=>{const{data:e}=s.value.find((e=>e.value===l.value)),{response:t}=e;d.value=t.map((e=>({label:e.text,value:e.type}))),t.length>0&&null===i.value&&(i.value=t[0].type)})(),(e,t)=>{const n=re,r=c,f=se;return U(),N(H,null,[$(r,{label:e.$t("CustomRule.CcDefend.Modal.Content.Action")},{default:E((()=>[P("div",Nt,[$(n,{value:A(l),"onUpdate:value":[t[0]||(t[0]=e=>D(l)?l.value=e:null),p],options:A(s)},null,8,["value","options"])])])),_:1},8,["label"]),le($(r,{label:e.$t("CustomRule.CcDefend.Modal.Content.BlockTime")},{default:E((()=>[P("div",Lt,[$(f,{value:A(o),"onUpdate:value":t[1]||(t[1]=e=>D(o)?o.value=e:null),"show-button":!1},{suffix:E((()=>[M(I(e.$t("Public.Unit.Seconds")),1)])),_:1},8,["value"])])])),_:1},8,["label"]),[[oe,"deny"===A(l)]]),"deny"===A(l)?(U(),T(r,{key:0,"show-feedback":!1,label:e.$t("CustomRule.CcDefend.Modal.Content.Status")},{default:E((()=>[P("div",zt,[$(n,{value:A(a),"onUpdate:value":t[2]||(t[2]=e=>D(a)?a.value=e:null),options:A(u)},null,8,["value","options"])])])),_:1},8,["label"])):G("",!0),"validate"===A(l)?(U(),T(r,{key:1,"show-feedback":!1,label:e.$t("CustomRule.Interdiction.Modal.Content.Verification")},{default:E((()=>[P("div",Pt,[$(n,{value:A(i),"onUpdate:value":t[3]||(t[3]=e=>D(i)?i.value=e:null),options:A(d)},null,8,["value","options"])])])),_:1},8,["label"])):G("",!0)],64)}}}),Bt={class:"w-700px p-24px"},qt={class:"title"},Ht={class:"w-200px"},Gt=(e=>(L("data-v-2e1c5be7"),e=e(),z(),e))((()=>P("span",null,"复制域名",-1))),Kt={class:"w-200px"},Vt={class:"title mt-8px"},Xt={class:"w-200px"},Yt={class:"w-200px"},Jt={class:"flex-1"},Qt={class:"title mt-8px"},Zt=a(F({__name:"index",setup(e,{expose:n}){const{isEdit:a,row:v}=R("component-data"),{t:h}=B(),{getList:m}=he(),y=t(),{sitesOption:g}=O(y),b=Y({name:"",server:[],action:"deny",response:"no_response",interval:60,threshold:300,blockTime:300,status:"444"}),w={name:{required:!0,message:"".concat(h("CustomRule.Interdiction.Modal.Content.RuleName.Placeholder")),trigger:["blur","input"]},rules:{validator:()=>{for(let e=0;e<_.value.length;e++){const t=_.value[e];for(let e=0;e<t.children.length;e++){const n=t.children[e];if(null===n.field||null===n.condition)return new Error(h("CustomRule.Interdiction.Modal.Content.Rules"));const{leftFactor:l,rightFactor:o}=n;if(l.show&&""===l.input&&null===l.select)return new Error(h("CustomRule.Interdiction.Modal.Content.Rules"));if(o.show&&""===o.input&&null===o.select)return new Error(h("CustomRule.Interdiction.Modal.Content.Rules"))}}return!0}}},_=W([]),C=W(null),x=W(),k=W("");J((()=>{if(g.value.length>0){const e=b.server.map((e=>{const t=g.value.find((t=>t.value===e));return null==t?void 0:t.label}));k.value=e.join(", ")}}));const{toClipboard:F}=be(),T=async e=>{try{await F(k.value,e.currentTarget),s("复制成功")}catch(t){u("复制失败")}},S=()=>{const e=j();return _.value.forEach((t=>{const n=j("and");t.children.forEach((e=>{null===e.field&&null===e.condition||n.children.push(L(e))})),e.children.push(n)})),e},j=(e="or")=>({logic:e,type:"block",option:null,children:[]}),L=e=>({type:"option",logic:"",children:[],option:{type:e.field||"",operator:e.condition||"",left_factor:q(e.condition,e.leftFactor),right_factor:q(e.condition,e.rightFactor)}}),z=["in","not_in"],q=(e,t)=>{const{widget:n}=t;return"text"!==n.type||z.includes(e||"")?l(t.select)?t.select.join(","):t.select||"":t.input};return a&&(b.name=v.name,b.server=v.servers||null,b.action=v.action.type,b.response=v.action.response.type,b.blockTime=v.action.block_time,b.interval=v.action.cc.interval,b.threshold=v.action.cc.threshold,b.status="".concat(v.action.response.status),Q((()=>{x.value.setRules(v.root)}))),n({onConfirm:async e=>{var t;await(null==(t=C.value)?void 0:t.validate());const n=(()=>{const{action:e,response:t}=b;return"allow"===e&&null===t&&(b.response="black_page"),{name:b.name,src:2,status:1,is_global:0,priority:0,root:S(),servers:b.server?b.server:[],action:{type:b.action,block_time:b.blockTime,cc:{interval:b.interval,threshold:b.threshold},response:{type:b.response||"",response_id:0,status:Number(b.status),headers:{},body:""}}}})();a?await d({...n,id:v.id}):await p(n),m(),e()}}),(e,t)=>{const n=r,l=o,s=c,u=i,d=se,p=f;return U(),N("div",Bt,[$(p,{ref_key:"formRef",ref:C,model:A(b),rules:w,"label-width":"116px","label-placement":"left","require-mark-placement":"left"},{default:E((()=>[P("div",qt,I(e.$t("CustomRule.CcDefend.Modal.Content.TitLe.0")),1),$(s,{label:e.$t("CustomRule.CcDefend.Modal.Content.Server")},{default:E((()=>[P("div",Ht,[$(we,{value:A(b).server,"onUpdate:value":t[0]||(t[0]=e=>A(b).server=e),"is-init":!A(a)},null,8,["value","is-init"])]),$(l,{size:"tiny",class:"ml-1.6rem",onClick:T},{default:E((()=>[$(n,{name:"copy",class:"mr-1",size:"13"}),Gt])),_:1})])),_:1},8,["label"]),$(s,{label:e.$t("CustomRule.CcDefend.Modal.Content.RuleName.Name"),path:"name"},{default:E((()=>[P("div",Kt,[$(u,{value:A(b).name,"onUpdate:value":t[1]||(t[1]=e=>A(b).name=e),spellcheck:"false",placeholder:e.$t("CustomRule.CcDefend.Modal.Content.RuleName.Placeholder")},null,8,["value","placeholder"])])])),_:1},8,["label"]),P("div",Vt,I(e.$t("CustomRule.CcDefend.Modal.Content.TitLe.1")),1),$(s,{label:e.$t("CustomRule.CcDefend.Modal.Content.Interval"),path:"interval"},{default:E((()=>[P("div",Xt,[$(d,{value:A(b).interval,"onUpdate:value":t[2]||(t[2]=e=>A(b).interval=e),"show-button":!1},{suffix:E((()=>[M(I(e.$t("Public.Unit.Seconds")),1)])),_:1},8,["value"])])])),_:1},8,["label"]),$(s,{label:e.$t("CustomRule.CcDefend.Modal.Content.Threshold"),path:"threshold"},{default:E((()=>[P("div",Yt,[$(d,{value:A(b).threshold,"onUpdate:value":t[3]||(t[3]=e=>A(b).threshold=e),"show-button":!1},{suffix:E((()=>[M(I(e.$t("Public.Unit.Time")),1)])),_:1},8,["value"])])])),_:1},8,["label"]),$(s,{label:"",class:"pl-36px",path:"rules"},{default:E((()=>[P("div",Jt,[$(Dt,{ref_key:"ruleRef",ref:x,value:A(_),"onUpdate:value":t[4]||(t[4]=e=>D(_)?_.value=e:null),"is-init":!A(a)},null,8,["value","is-init"])])])),_:1}),P("div",Qt,I(e.$t("CustomRule.CcDefend.Modal.Content.TitLe.2")),1),$(Wt,{action:A(b).action,"onUpdate:action":t[5]||(t[5]=e=>A(b).action=e),status:A(b).status,"onUpdate:status":t[6]||(t[6]=e=>A(b).status=e),response:A(b).response,"onUpdate:response":t[7]||(t[7]=e=>A(b).response=e),blockTime:A(b).blockTime,"onUpdate:blockTime":t[8]||(t[8]=e=>A(b).blockTime=e)},null,8,["action","status","response","blockTime"])])),_:1},8,["model"])])}}}),[["__scopeId","data-v-2e1c5be7"]]),en=P("p",{class:"text-desc mb-10px"},"*注：命中次数每3秒钟且需要有新请求触发才会更新一次",-1);function tn(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!te(e)}const nn=F({__name:"index",setup(n){const{t:a}=B(),i=t(),r=Y({type:2,p:1,p_size:20,keyword:""}),c=Y({data:[],total:0}),{loading:s,setLoading:u}=v(),d=async()=>{try{u(!0),await i.getConfig(2);const{res:e}=await g(ne(r)),{list:t,total:n}=e;c.data=l(t)?t:[],c.total=n}finally{u(!1)}},f=()=>{r.p=1,d()},_=Y({show:!1,title:"".concat(a("CustomRule.CcDefend.Modal.AddTitle")),data:{isEdit:!1,row:{}}}),k=()=>{_.data.isEdit=!1,_.data.row={},_.title="".concat(a("CustomRule.CcDefend.Modal.AddTitle")),_.show=!0},R=W([{key:"name",title:"".concat(a("CustomRule.CcDefend.Table.Name")),minWidth:160,ellipsis:{tooltip:{width:"trigger"}}},{key:"servers",title:"".concat(a("CustomRule.CcDefend.Table.Servers")),width:"16%",minWidth:140,ellipsis:{tooltip:{width:"trigger"}},render:e=>i.getSiteName(e.servers)},{key:"hit",title:"".concat(a("CustomRule.CcDefend.Table.Hit")),width:"10%",minWidth:100,render:e=>$(me,{count:e.hit},null)},{key:"root",title:"".concat(a("CustomRule.CcDefend.Table.Root")),width:"26%",minWidth:160,render:({root:e})=>(e=>{const t=[],n=e=>{for(let l=0;l<e.length;l++)if("block"===e[l].type)n(e[l].children);else if("option"===e[l].type){const{option:n}=e[l];n&&t.push(n.type)}};return n(e.children),[...new Set(t)].map((e=>i.getConditionName(e))).join("，")})(e)},{key:"action",title:"".concat(a("CustomRule.CcDefend.Table.Action")),width:"14%",minWidth:120,render:({action:e})=>{var t;return i.getExecuteOpt(e.type,(null==(t=e.response)?void 0:t.type)||"")}},{key:"action",title:"".concat(a("Public.Table.Action")),width:"10%",minWidth:80,render:e=>{let t,n;return $("div",{class:"action"},[$(h,{onClick:()=>{S(e)}},{default:()=>[M("复制")]}),$(h,{onClick:()=>{F(e)}},tn(t=a("Public.Btn.Edit"))?t:{default:()=>[t]}),$(h,{onClick:()=>{I(e)}},tn(n=a("Public.Btn.Del"))?n:{default:()=>[n]})])}}]),F=e=>{_.data.isEdit=!0,_.data.row=e,_.title="".concat(a("CustomRule.CcDefend.Modal.EditTitle"),"【").concat(e.name,"】"),_.show=!0},I=e=>{m({title:"".concat(a("CustomRule.CcDefend.DelModal.TitLe"),"【").concat(e.name,"】"),content:"".concat(a("CustomRule.CcDefend.DelModal.Content")),onConfirm:async()=>{await y({ids:[e.id]}),d()}})},S=e=>{const t=(e=>{const t=ne(e);return{name:"".concat(t.name,"_copy_").concat(ae(6)),src:2,status:1,is_global:0,priority:0,root:t.root,servers:t.servers?t.servers:[],action:{type:t.action.type,block_time:t.action.block_time,cc:{interval:t.action.cc.interval,threshold:t.action.cc.threshold},response:{type:t.action.response.type||"",response_id:0,status:Number(t.action.response.status),headers:{},body:""}}}})(e);m({title:"复制规则【".concat(e.name,"】"),content:"是否复制该规则，并创建为新规则？",onConfirm:async()=>{await p(t),d()}})};return ve({getList:d}),Z((()=>{d()})),ee((()=>{i.clearConfig()})),(t,n)=>{const l=o,a=x,i=C,u=w,p=b,v=e;return U(),T(v,null,{toolsLeft:E((()=>[$(l,{type:"primary",onClick:k},{default:E((()=>[M("添加自定义CC防御")])),_:1})])),toolsRight:E((()=>[$(a,{value:A(r).keyword,"onUpdate:value":n[0]||(n[0]=e=>A(r).keyword=e),placeholder:t.$t("CustomRule.Search"),onSearch:f},null,8,["value","placeholder"])])),content:E((()=>[en,$(i,{loading:A(s),data:A(c).data,columns:A(R)},null,8,["loading","data","columns"])])),pageRight:E((()=>[$(u,{page:A(r).p,"onUpdate:page":n[1]||(n[1]=e=>A(r).p=e),"page-size":A(r).p_size,"onUpdate:pageSize":n[2]||(n[2]=e=>A(r).p_size=e),"item-count":A(c).total,onRefresh:d},null,8,["page","page-size","item-count"])])),modal:E((()=>[$(p,{show:A(_).show,"onUpdate:show":n[3]||(n[3]=e=>A(_).show=e),title:A(_).title,data:A(_).data,padding:"0","is-footer":!0,component:Zt},null,8,["show","title","data"])])),_:1})}}}),ln={class:"my-18px"};const on=a({},[["render",function(e,t){const n=ie;return U(),N("div",ln,[$(n,{class:"w-38px justify-center"},{default:E((()=>[M("Or")])),_:1})])}]]),an={},rn=e=>(L("data-v-80ea132e"),e=e(),z(),e),cn={class:"flex flex-center flex-col w-38px"},sn=rn((()=>P("div",{class:"seg"},null,-1))),un=rn((()=>P("div",{class:"seg"},null,-1)));const dn=a(an,[["render",function(e,t){const n=ie;return U(),N("div",cn,[sn,$(n,{class:"w-38px justify-center"},{default:E((()=>[M("And")])),_:1}),un])}],["__scopeId","data-v-80ea132e"]]),pn={class:"relative flex items-center w-full h-full"},fn={class:"tips"},vn=a(F({__name:"content",props:{input:{default:""},select:{default:null},condition:{default:null},factor:{},type:{default:"right"}},setup(e){const t=e,{t:n}=B(),a=S(t,"input"),r=S(t,"select"),c=q((()=>null===t.condition)),s=["select","area_select"],u=["in","not_in"],d=q((()=>{const{factor:e}=t;return"text"===e.widget.type})),p=q((()=>{const{factor:e}=t;return s.includes(e.widget.type)})),f=q((()=>"left"!==t.type&&u.includes(t.condition||""))),{areaOptions:v}=Ee(),h=q((()=>{const{factor:e}=t,{widget:n}=e;return"area_select"===n.type?v.value:n.value.map((e=>({label:e.label,value:e.key})))})),m=()=>{r.value=h.value.map((e=>e.value))},y=()=>{r.value=[]},g=W(""),b=e=>{g.value=e},w=()=>{""!==g.value&&(l(r.value)?l(r.value)&&!r.value.includes(g.value)&&r.value.push(g.value):r.value=[g.value],g.value="")};return(e,t)=>{const l=i,s=re,u=o,v=ce;return U(),N("div",pn,[A(d)?(U(),N(H,{key:0},[A(f)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[1]||(t[1]=e=>D(r)?r.value=e:null),tag:"",multiple:"",filterable:"","show-arrow":!1,show:!1,"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder,onSearch:b,onBlur:w},null,8,["value","placeholder"])):(U(),T(l,{key:0,value:A(a),"onUpdate:value":t[0]||(t[0]=e=>D(a)?a.value=e:null),spellcheck:"false",disabled:A(c),placeholder:e.factor.widget.placeholder},null,8,["value","disabled","placeholder"])),P("div",fn,I(e.factor.widget.hint?"".concat(e.factor.widget.hint).concat(A(f)?"，".concat(A(n)("CustomRule.Enter")):""):""),1)],64)):G("",!0),A(p)?(U(),T(s,{key:1,value:A(r),"onUpdate:value":t[2]||(t[2]=e=>D(r)?r.value=e:null),options:A(h),disabled:A(c),multiple:A(f),"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder},K({_:2},[A(f)?{name:"action",fn:E((()=>[$(v,null,{default:E((()=>[$(u,{onClick:m},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.All")),1)])),_:1}),$(u,{onClick:y},{default:E((()=>[M(I(e.$t("CustomRule.Checkbox.NotAll")),1)])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["value","options","disabled","multiple","placeholder"])):G("",!0)])}}}),[["__scopeId","data-v-be3da913"]]),hn=e=>(L("data-v-712bd08b"),e=e(),z(),e),mn={class:"rows title"},yn={class:"field"},gn={class:"condition"},bn={class:"content"},wn=hn((()=>P("div",{class:"btn"},null,-1))),_n={class:"rows"},Cn={class:"field"},xn={class:"condition"},kn={class:"content"},Rn={key:0,class:"w-140px mr-8px"},Fn={class:"flex-1 w-0"},Un={class:"btn"},Tn=["onClick"],En=hn((()=>P("div",null,null,-1))),Mn=a(F({__name:"index",props:{isInit:{type:Boolean,default:!0},value:{default:()=>[]}},setup(e,{expose:n}){const a=e,i=S(a,"value"),c=t(),{config:s}=O(c),u={type:"or",children:[]},d={input:"",select:null,show:!1,widget:{hint:"",placeholder:"",type:"text",value:[]}},p={type:"and",field:null,condition:null,conOptions:[],leftFactor:_(d),rightFactor:_(d)},f=["select","area_select"],v=["in","not_in"],h=q((()=>s.value?s.value.options.map((e=>({label:e.text,value:e.type,data:e}))):[])),m=(e,t)=>(n,l)=>{const o=i.value[e].children[t],a=l.data;o.conOptions=a.operators.map((e=>({label:c.getOperatorName(e),value:e}))),o.condition=a.operators[0]||null,o.leftFactor=_(d),o.rightFactor=_(d),a.left_factor_enabled&&(o.leftFactor.show=a.left_factor_enabled,o.leftFactor.widget=a.left_widget),a.right_factor_enabled&&(o.rightFactor.widget=a.right_widget,o.rightFactor.show=a.right_factor_enabled)},y=(e,t)=>n=>{const o=i.value[e].children[t],{rightFactor:a}=o,{widget:r}=a;if(f.includes(r.type)){if(null===a.select)return;v.includes(n||"")?a.select=l(a.select)?a.select:[a.select]:a.select=l(a.select)?a.select[0]:a.select}"text"===r.type&&(v.includes(n||"")&&""!==a.input&&(a.select=[a.input],a.input=""),null!==a.select&&(a.input=l(a.select)?a.select[0]:a.select))},g=q((()=>i.value.map((e=>e.children.length)).reduce(((e,t)=>e+t))>1)),b=(e,t)=>t===i.value.length-1&&e===i.value[t].children.length-1,w=(e,t=0)=>{i.value[t].children.splice(e+1,0,_(p))},C=()=>{i.value.push(_(u)),w(0,i.value.length-1)},x=(e,t,n)=>"text"!==n.widget.type||v.includes(t)?"":e,k=(e,t,n)=>v.includes(t)?e?e.split(","):[]:f.includes(n.widget.type)&&e||null;return a.isInit&&0===i.value.length&&C(),n({setRules:e=>{const t=[];e.children.forEach((e=>{const n=_(u);e.children.forEach((e=>{const{option:t}=e;if(!t)return;const l=_(p);l.field=t.type,l.condition=t.operator,((e,t)=>{if(s.value){const{options:n}=s.value;for(let l=0;l<n.length;l++)if(n[l].type===e){t(n[l]);break}}})(t.type,(e=>{if(e.left_factor_enabled){const n=(null==t?void 0:t.left_factor)||"";l.leftFactor.show=e.left_factor_enabled,l.leftFactor.widget=e.left_widget,l.leftFactor.input=x(n,t.operator,l.leftFactor),l.leftFactor.select=k(n,t.operator,l.leftFactor)}if(e.right_factor_enabled){const n=(null==t?void 0:t.right_factor)||"";l.rightFactor.show=e.right_factor_enabled,l.rightFactor.widget=e.right_widget,l.rightFactor.input=x(n,t.operator,l.rightFactor),l.rightFactor.select=k(n,t.operator,l.rightFactor)}l.conOptions=e.operators.map((e=>({label:c.getOperatorName(e),value:e})))})),n.children.push(l)})),t.push(n)})),t.length>0?i.value=t:C()}}),(e,t)=>{const n=re,l=o,a=r;return U(),N("div",null,[P("div",mn,[P("div",yn,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.0")),1),P("div",gn,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.1")),1),P("div",bn,I(e.$t("CustomRule.Interdiction.Modal.Content.Rows.2")),1),wn]),(U(!0),N(H,null,V(A(i),((e,t)=>(U(),N("div",{key:"".concat(t+1)},[0!==t?(U(),T(on,{key:0})):G("",!0),(U(!0),N(H,null,V(e.children,((e,o)=>(U(),N("div",{key:"".concat(o+1)},[0!==o?(U(),T(dn,{key:0})):G("",!0),P("div",_n,[P("div",Cn,[$(n,j({value:e.field,"onUpdate:value":t=>e.field=t,options:A(h),"consistent-menu-width":!1},X({"update:value":m(t,o)})),null,16,["value","onUpdate:value","options"])]),P("div",xn,[e.leftFactor.show?(U(),T(vn,{key:0,input:e.leftFactor.input,"onUpdate:input":t=>e.leftFactor.input=t,select:e.leftFactor.select,"onUpdate:select":t=>e.leftFactor.select=t,type:"left",condition:e.condition,factor:e.leftFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])):(U(),T(n,j({key:1,value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"]))]),P("div",kn,[e.leftFactor.show?(U(),N("div",Rn,[$(n,j({value:e.condition,"onUpdate:value":t=>e.condition=t,disabled:null===e.field,options:e.conOptions},X({"update:value":y(t,o)})),null,16,["value","onUpdate:value","disabled","options"])])):G("",!0),P("div",Fn,[$(vn,{input:e.rightFactor.input,"onUpdate:input":t=>e.rightFactor.input=t,select:e.rightFactor.select,"onUpdate:select":t=>e.rightFactor.select=t,type:"right",condition:e.condition,factor:e.rightFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])])]),P("div",Un,[$(l,{onClick:e=>w(o,t)},{default:E((()=>[M("And")])),_:2},1032,["onClick"]),b(o,t)?(U(),T(l,{key:0,class:"ml-8px",onClick:C},{default:E((()=>[M("Or")])),_:1})):G("",!0),A(g)?(U(),N("div",{key:1,class:"close",onClick:e=>((e,t)=>{const n=i.value[t];n.children.length>1?n.children.splice(e,1):i.value.splice(t,1)})(o,t)},[$(a,{name:"close",size:"16"})],8,Tn)):G("",!0)])])])))),128))])))),128)),En])}}}),[["__scopeId","data-v-712bd08b"]]),In={class:"w-800px p-24px"},Sn={class:"title"},On={class:"w-200px"},$n=(e=>(L("data-v-f5d17401"),e=e(),z(),e))((()=>P("span",null,"复制域名",-1))),jn={class:"w-200px"},An={class:"title mt-8px"},Dn={class:"flex-1"},Nn={class:"title mt-8px"},Ln={class:"w-200px"},zn={class:"w-200px"},Pn={class:"w-200px"},Wn={class:"text-desc ml-12px"},Bn=a(F({__name:"index",setup(e,{expose:n}){const{t:a}=B(),{isEdit:v,row:h}=R("component-data"),{getList:m}=he(),y=t(),{executeOptions:g,sitesOption:b}=O(y),w=q((()=>{const{data:e}=g.value.find((e=>e.value===_.action)),{response:t}=e;return t.map((e=>({label:e.text,value:parseFloat(e.type)})))})),_=Y({name:"",server:[],action:"redirect",response:null,url:"",status:302}),C={name:{required:!0,message:"".concat(a("CustomRule.Interdiction.Modal.Content.RuleName.Placeholder")),trigger:["blur","input"]},rules:{validator:()=>{for(let e=0;e<x.value.length;e++){const t=x.value[e];for(let e=0;e<t.children.length;e++){const n=t.children[e];if(null===n.field||null===n.condition)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")));const{leftFactor:l,rightFactor:o}=n;if(l.show&&""===l.input&&null===l.select)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")));if(o.show&&""===o.input&&null===o.select)return new Error("".concat(a("CustomRule.Interdiction.Modal.Content.Rules")))}}return!0}},operation:{required:!0,trigger:["blur","input"],validator:()=>""!==_.url||new Error("url不能为空")}},x=W([]),k=W(null),F=W(),T=W("");J((()=>{if(b.value.length>0){const e=_.server.map((e=>{const t=b.value.find((t=>t.value===e));return null==t?void 0:t.label}));T.value=e.join(", ")}}));const{toClipboard:M}=be(),S=async e=>{try{await M(T.value,e.currentTarget),s("复制成功")}catch(t){u("复制失败")}},j=()=>{const e=L();return x.value.forEach((t=>{const n=L("and");t.children.forEach((e=>{null===e.field&&null===e.condition||n.children.push(z(e))})),e.children.push(n)})),e},L=(e="or")=>({logic:e,type:"block",option:null,children:[]}),z=e=>({type:"option",logic:"",children:[],option:{type:e.field||"",operator:e.condition||"",left_factor:G(e.condition,e.leftFactor),right_factor:G(e.condition,e.rightFactor)}}),H=["in","not_in"],G=(e,t)=>{const{widget:n}=t;return"text"!==n.type||H.includes(e||"")?l(t.select)?t.select.join(","):t.select||"":t.input};return v&&(_.name=h.name,_.server=h.servers||null,_.action=h.action.type,_.response=h.action.response.type,_.url=h.action.response.body,_.status=h.action.response.status,Q((()=>{F.value.setRules(h.root)}))),n({onConfirm:async e=>{var t;await(null==(t=k.value)?void 0:t.validate());const n=(()=>{const{action:e,response:t}=_;return"allow"===e&&null===t&&(_.response="black_page"),{name:_.name,src:3,servers:_.server?_.server:[],status:1,is_global:0,priority:0,root:j(),action:{type:_.action,response:{type:"url",response_id:0,status:_.status,headers:{},body:_.url||""}}}})();v?await d({...n,id:h.id}):await p(n),m(),e()}}),(e,t)=>{const n=r,l=o,a=c,s=i,u=re,d=f;return U(),N("div",In,[$(d,{ref_key:"formRef",ref:k,model:A(_),rules:C,"label-width":"116px","label-placement":"left","require-mark-placement":"left"},{default:E((()=>[P("div",Sn,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.0")),1),$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.Server")},{default:E((()=>[P("div",On,[$(we,{value:A(_).server,"onUpdate:value":t[0]||(t[0]=e=>A(_).server=e),"is-init":!A(v)},null,8,["value","is-init"])]),$(l,{size:"tiny",class:"ml-1.6rem",onClick:S},{default:E((()=>[$(n,{name:"copy",class:"mr-1",size:"13"}),$n])),_:1})])),_:1},8,["label"]),$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.RuleName.Name"),path:"name"},{default:E((()=>[P("div",jn,[$(s,{value:A(_).name,"onUpdate:value":t[1]||(t[1]=e=>A(_).name=e),spellcheck:"false",placeholder:e.$t("CustomRule.Interdiction.Modal.Content.RuleName.Placeholder")},null,8,["value","placeholder"])])])),_:1},8,["label"]),P("div",An,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.1")),1),$(a,{label:"",class:"pl-36px",path:"rules"},{default:E((()=>[P("div",Dn,[$(Mn,{ref_key:"ruleRef",ref:F,value:A(x),"onUpdate:value":t[2]||(t[2]=e=>D(x)?x.value=e:null),"is-init":!A(v)},null,8,["value","is-init"])])])),_:1}),P("div",Nn,I(e.$t("CustomRule.Interdiction.Modal.Content.TitLe.2")),1),$(a,{label:e.$t("CustomRule.Interdiction.Modal.Content.Action")},{default:E((()=>[P("div",Ln,[$(u,{value:A(_).action,"onUpdate:value":t[3]||(t[3]=e=>A(_).action=e),options:A(g)},null,8,["value","options"])])])),_:1},8,["label"]),$(a,{label:"重定向类型"},{default:E((()=>[P("div",zn,[$(u,{value:A(_).status,"onUpdate:value":t[4]||(t[4]=e=>A(_).status=e),options:A(w)},null,8,["value","options"])])])),_:1}),$(a,{label:"重定向url",path:"operation"},{default:E((()=>[P("div",Pn,[$(s,{value:A(_).url,"onUpdate:value":t[5]||(t[5]=e=>A(_).url=e),placeholder:"请输入重定向url"},null,8,["value"])]),P("div",Wn,I("示例：http://bt.com/1.html"),1)])),_:1})])),_:1},8,["model"])])}}}),[["__scopeId","data-v-f5d17401"]]),qn=P("p",{class:"text-desc mb-10px"},"*注：命中次数每3秒钟且需要有新请求触发才会更新一次",-1);function Hn(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!te(e)}const Gn=F({__name:"index",setup(n){const{t:a}=B(),i=t(),r=Y({type:3,p:1,p_size:20,keyword:""}),c=Y({data:[],total:0}),{loading:s,setLoading:u}=v(),d=async()=>{try{u(!0),await i.getConfig(3);const{res:e}=await g(ne(r)),{list:t,total:n}=e;c.data=l(t)?t:[],c.total=n}finally{u(!1)}},f=()=>{r.p=1,d()},_=Y({show:!1,title:"添加自定义重定向",data:{isEdit:!1,row:{}}}),k=()=>{_.data.isEdit=!1,_.data.row={},_.title="添加自定义重定向",_.show=!0},R=W([{key:"name",title:"".concat(a("CustomRule.CcDefend.Table.Name")),minWidth:160,ellipsis:{tooltip:{width:"trigger"}}},{key:"servers",title:"".concat(a("CustomRule.CcDefend.Table.Servers")),width:"16%",minWidth:140,ellipsis:{tooltip:{width:"trigger"}},render:e=>i.getSiteName(e.servers)},{key:"hit",title:"".concat(a("CustomRule.CcDefend.Table.Hit")),width:"10%",minWidth:100,render:e=>$(me,{count:e.hit},null)},{key:"root",title:"".concat(a("CustomRule.CcDefend.Table.Root")),width:"26%",minWidth:160,render:({root:e})=>(e=>{const t=[],n=e=>{for(let l=0;l<e.length;l++)if("block"===e[l].type)n(e[l].children);else if("option"===e[l].type){const{option:n}=e[l];n&&t.push(n.type)}};return n(e.children),[...new Set(t)].map((e=>i.getConditionName(e))).join("，")})(e)},{key:"action",title:"".concat(a("CustomRule.CcDefend.Table.Action")),width:"14%",minWidth:120,render:({action:e})=>{var t;return i.getExecuteOpt(e.type,(null==(t=e.response)?void 0:t.type)||"")}},{key:"action",title:"".concat(a("Public.Table.Action")),width:"10%",minWidth:80,render:e=>{let t,n;return $("div",{class:"action"},[$(h,{onClick:()=>{S(e)}},{default:()=>[M("复制")]}),$(h,{onClick:()=>{F(e)}},Hn(t=a("Public.Btn.Edit"))?t:{default:()=>[t]}),$(h,{onClick:()=>{I(e)}},Hn(n=a("Public.Btn.Del"))?n:{default:()=>[n]})])}}]),F=e=>{_.data.isEdit=!0,_.data.row=e,_.title="编辑自定义重定向【".concat(e.name,"】"),_.show=!0},I=e=>{m({title:"".concat(a("CustomRule.CcDefend.DelModal.TitLe"),"【").concat(e.name,"】"),content:"".concat(a("CustomRule.CcDefend.DelModal.Content")),onConfirm:async()=>{await y({ids:[e.id]}),d()}})},S=e=>{const t=(e=>{const t=ne(e);return{name:"".concat(t.name,"_copy_").concat(ae(6)),src:3,servers:t.servers?t.servers:[],status:1,is_global:0,priority:0,root:t.root,action:{type:t.action.type,response:{type:"url",response_id:0,status:t.action.response.status,headers:{},body:t.action.response.body||""}}}})(e);m({title:"复制规则【".concat(e.name,"】"),content:"是否复制该规则，并创建为新规则？",onConfirm:async()=>{await p(t),d()}})};return ve({getList:d}),Z((()=>{d()})),ee((()=>{i.clearConfig()})),(t,n)=>{const l=o,a=x,i=C,u=w,p=b,v=e;return U(),T(v,null,{toolsLeft:E((()=>[$(l,{type:"primary",onClick:k},{default:E((()=>[M("添加自定义重定向")])),_:1})])),toolsRight:E((()=>[$(a,{value:A(r).keyword,"onUpdate:value":n[0]||(n[0]=e=>A(r).keyword=e),placeholder:t.$t("CustomRule.Search"),onSearch:f},null,8,["value","placeholder"])])),content:E((()=>[qn,$(i,{loading:A(s),data:A(c).data,columns:A(R)},null,8,["loading","data","columns"])])),pageRight:E((()=>[$(u,{page:A(r).p,"onUpdate:page":n[1]||(n[1]=e=>A(r).p=e),"page-size":A(r).p_size,"onUpdate:pageSize":n[2]||(n[2]=e=>A(r).p_size=e),"item-count":A(c).total,onRefresh:d},null,8,["page","page-size","item-count"])])),modal:E((()=>[$(p,{show:A(_).show,"onUpdate:show":n[3]||(n[3]=e=>A(_).show=e),title:A(_).title,data:A(_).data,padding:"0","is-footer":!0,component:Bn},null,8,["show","title","data"])])),_:1})}}});export{st as _,nn as a,Gn as b};
